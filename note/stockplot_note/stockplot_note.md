
[仮タイトル]plotlyでキャンドルチャートプロット

# パッケージ紹介

## Plotly

グラフ描画はPlotlyに行わせます。
簡単なことだったら無料で使えます。

インストールは

`conda install plotly`

または

`pip install plotly`

有名だと思うのでここでは言及しません。

## stockstats
データ操作はstockstatsというパッケージを使います。

インストールは

`pip install stockstats`

`stockstats`は金融指標を簡単に取得できる改造pandas.DataFrameクラスです。


```python
# 使い方
np.random.seed(2)
df = pd.DataFrame(np.random.randn(10,4), columns=['open', 'high', 'low', 'close'])
from stockstats import StockDataFrame
sdf = StockDataFrame(df)  # pandasデータフレームをStockDataFrameに入れてあげる
sdf
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.416758</td>
      <td>-0.056267</td>
      <td>-2.136196</td>
      <td>1.640271</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.793436</td>
      <td>-0.841747</td>
      <td>0.502881</td>
      <td>-1.245288</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.057952</td>
      <td>-0.909008</td>
      <td>0.551454</td>
      <td>2.292208</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.041539</td>
      <td>-1.117925</td>
      <td>0.539058</td>
      <td>-0.596160</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.019130</td>
      <td>1.175001</td>
      <td>-0.747871</td>
      <td>0.009025</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.878108</td>
      <td>-0.156434</td>
      <td>0.256570</td>
      <td>-0.988779</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.338822</td>
      <td>-0.236184</td>
      <td>-0.637655</td>
      <td>-1.187612</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-1.421217</td>
      <td>-0.153495</td>
      <td>-0.269057</td>
      <td>2.231367</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-2.434768</td>
      <td>0.112727</td>
      <td>0.370445</td>
      <td>1.359634</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.501857</td>
      <td>-0.844214</td>
      <td>0.000010</td>
      <td>0.542353</td>
    </tr>
  </tbody>
</table>
</div>



見た目に変化はありませんが金融指標を`stockstats`の文法に従って`get`メソッド、またはディクショナリの取得をすると、金融指標のカラムが追加されます。


```python
sdf.get('close_5_sma'); sdf
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>close_5_sma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.416758</td>
      <td>-0.056267</td>
      <td>-2.136196</td>
      <td>1.640271</td>
      <td>1.640271</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.793436</td>
      <td>-0.841747</td>
      <td>0.502881</td>
      <td>-1.245288</td>
      <td>0.197491</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.057952</td>
      <td>-0.909008</td>
      <td>0.551454</td>
      <td>2.292208</td>
      <td>0.895730</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.041539</td>
      <td>-1.117925</td>
      <td>0.539058</td>
      <td>-0.596160</td>
      <td>0.522758</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.019130</td>
      <td>1.175001</td>
      <td>-0.747871</td>
      <td>0.009025</td>
      <td>0.420011</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.878108</td>
      <td>-0.156434</td>
      <td>0.256570</td>
      <td>-0.988779</td>
      <td>-0.105799</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.338822</td>
      <td>-0.236184</td>
      <td>-0.637655</td>
      <td>-1.187612</td>
      <td>-0.094264</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-1.421217</td>
      <td>-0.153495</td>
      <td>-0.269057</td>
      <td>2.231367</td>
      <td>-0.106432</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-2.434768</td>
      <td>0.112727</td>
      <td>0.370445</td>
      <td>1.359634</td>
      <td>0.284727</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.501857</td>
      <td>-0.844214</td>
      <td>0.000010</td>
      <td>0.542353</td>
      <td>0.391392</td>
    </tr>
  </tbody>
</table>
</div>



close_5_sma: 終値の5足移動平均線が追加されました。


```python
sdf['close_5_sma']; sdf
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>close_5_sma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.416758</td>
      <td>-0.056267</td>
      <td>-2.136196</td>
      <td>1.640271</td>
      <td>1.640271</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.793436</td>
      <td>-0.841747</td>
      <td>0.502881</td>
      <td>-1.245288</td>
      <td>0.197491</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.057952</td>
      <td>-0.909008</td>
      <td>0.551454</td>
      <td>2.292208</td>
      <td>0.895730</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.041539</td>
      <td>-1.117925</td>
      <td>0.539058</td>
      <td>-0.596160</td>
      <td>0.522758</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.019130</td>
      <td>1.175001</td>
      <td>-0.747871</td>
      <td>0.009025</td>
      <td>0.420011</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.878108</td>
      <td>-0.156434</td>
      <td>0.256570</td>
      <td>-0.988779</td>
      <td>-0.105799</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.338822</td>
      <td>-0.236184</td>
      <td>-0.637655</td>
      <td>-1.187612</td>
      <td>-0.094264</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-1.421217</td>
      <td>-0.153495</td>
      <td>-0.269057</td>
      <td>2.231367</td>
      <td>-0.106432</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-2.434768</td>
      <td>0.112727</td>
      <td>0.370445</td>
      <td>1.359634</td>
      <td>0.284727</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.501857</td>
      <td>-0.844214</td>
      <td>0.000010</td>
      <td>0.542353</td>
      <td>0.391392</td>
    </tr>
  </tbody>
</table>
</div>



`sdf.get('close_5_sma')`と全く同じです。
getの方がありえない指標を打ち込んだときエラーが発生しません。
どちら良いかは用途次第でしょう。

詳しくは公式をご覧ください。

* [github - jealous/stockstats](https://github.com/jealous/stockstats)
* [PyPI - stockstats](https://pypi.python.org/pypi/stockstats)

## stockplot

これが私が作ったやつです。
stockstatsを楽にplotするためのクラスStockPlotを作成しました。
この記事はこれの使い方紹介です。

# 下準備

## モジュールインポート


```python
import sys, os
sys.path.append('../../common/')
```

## サンプルデータの作成


```python
np.random.seed(9)
from randomwalk import randomwalk
df = randomwalk(60 * 24 * 90, freq='T', tick=0.01, start=pd.datetime(2017, 3, 20)
                ).resample('B').ohlc() + 115  # 90日分の1分足を日足に直す
```

ランダムウォークの作成。
詳しくは[pythonでローソク足(candle chart)の描画](http://qiita.com/u1and0/items/1d9afdb7216c3d2320ef)をご覧ください。

## pd.DataFrame型をStockDataFrame型に変換


```python
from stockstats import StockDataFrame
sdf = StockDataFrame(df.copy())
```

# StockPlotクラスの使用方法

## stockplot.pyのインポート


```python
import stockplot as sp
```


<script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window.Plotly) {{require(['plotly'],function(plotly) {window.Plotly=plotly;});}}</script>


stockplot.pyのソースコード


```python
import numpy as np
import pandas as pd
# ----------User Module----------
from randomwalk import randomwalk
import stockstats as ss
# ----------Plotly Module----------
from plotly.tools import FigureFactory as FF
import plotly.offline as pyo
import plotly.graph_objs as go
pyo.init_notebook_mode(connected=True)


class StockPlot:
    """StockDataFrameの可視化ツール

    # なにがしたい

    * StockDataFrameにプロット能力を持たせたい。
    * プロット能力はStockDataFrameクラスにメソッドを付与してあげる。

    ```python
    df = randomwalk(60 * 24 * 90, freq='T', tick=0.01,
                    start=pd.datetime(2017, 3, 20)).resample('B').ohlc() + 115  # 90日分の1分足を日足に直す
    dfs = stockstats.StockDataFrame(df)
    dfs.add_indicator('hoge'): インジケーターの追加
    dfs.candle_plot(): キャンドルチャートとインジケータの表示
    dfs.remove_indicator('hoge'): インジケーターの削除
    ```

    # メソッド詳細
    * dfs.add_indicator('hoge')
        * dfs.get('hoge')を実行して、グラフに挿入するデータフレームを入手する
            > `indi = dfs.get('hoge')`
        * プロットするための形plotterに変換してやる
            > `plotter = go.Scatter(x=..., y=...) <- indiを使う`
        * plotterをStockPlotのattributeである`fig`に入れてやる
            > `fig['data'].append(plotter)`

    * dfs.candle_plot()
        * `fig = FF.create_candlestick... `でキャンドルチャートを取得できる
        * figに対してadd_indicator / remove_inidcatorで指標の追加 / 削除が行われる。

    * dfs.plot()
        * plt.show()に当たるのかな

        ```python
                self.fig['layout'].update(xaxis={'showgrid': True})  # figのレイアウト調整をして
                pyo.plot(self.fig, filename=filename, validate=False)  # plotlyでhtmlとしてプロットする
        ```

        別にdataframe的な操作は必要ないから、
        StockDataFrameのサブクラスになる必要はないので

        強いていうなら、StockDataFrameにfigという属性持たせて、
        plotlyとつなげたいから
        def __init()__をStockDataFrameにあてがってあげればいいのか
        StockDataFrame.__init__ = __init__

    # TODO
    * koma_ashi
    * subplot

    """

    def __init__(self, sdf):
        self.StockDataFrame = sdf
        self.fig = FF.create_candlestick(self.StockDataFrame.open,
                                         self.StockDataFrame.high,
                                         self.StockDataFrame.low,
                                         self.StockDataFrame.close,
                                         dates=self.StockDataFrame.index)

    def candle_plot(self, filebasename='candlestick_and_trace'):
        """StockDataFrameをキャンドルチャート化する
        引数: dfs: StockDataFrame
        戻り値: plotly plot"""
        self.fig['layout'].update(xaxis={'showgrid': True})
        ax = pyo.iplot(self.fig, filename=filebasename + '.html', validate=False)
        # pyo.plot(self.fig, image='png', image_filename=filebasename, validate=False)
        return ax

    def add_indicator(self, indicator):
        indi = self.StockDataFrame.get(indicator)
        plotter = go.Scatter(x=indi.index, y=indi,
                             name=indicator.upper().replace('_', ' '))  # グラフに追加する形式変換
        self.fig['data'].append(plotter)
        return indi

    def remove_indicator(self, indicator):
        indi = indicator.lower().replace(' ', '_')
        INDI = indicator.upper().replace('_', ' ')
        self.StockDataFrame.pop(indi)
        for dicc in self.fig['data']:
            if dicc['name'] == INDI:
                self.fig['data'].remove(dicc)
                return dicc
```


<script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window.Plotly) {{require(['plotly'],function(plotly) {window.Plotly=plotly;});}}</script>



```python
# StockPlotクラスのインスタンス化
x = sp.StockPlot(sdf)
```


```python
# キャンドルチャートのプロット
x.candle_plot()
```


<div id="a451ae90-0cd7-4612-acac-511698612327" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("a451ae90-0cd7-4612-acac-511698612327", [{"type": "box", "x": ["2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16"], "fillcolor": "#3D9970", "whiskerwidth": 0, "y": [114.62, 114.77, 115.05, 115.05, 115.05, 115.14, 114.62, 114.91, 115.08, 115.08, 115.08, 115.08, 115.01, 115.07, 115.43, 115.43, 115.43, 115.59, 114.96, 115.06, 115.43, 115.43, 115.43, 115.56, 114.88, 115.08, 115.1, 115.1, 115.1, 115.28, 115.0, 115.1, 115.26, 115.26, 115.26, 115.47, 114.65, 114.85, 115.34, 115.34, 115.34, 115.34, 115.3, 115.35, 115.38, 115.38, 115.38, 115.68, 114.28, 114.51, 114.95, 114.95, 114.95, 115.12, 114.55, 114.94, 115.08, 115.08, 115.08, 115.13, 114.89, 115.08, 115.22, 115.22, 115.22, 115.27, 114.93, 114.95, 115.83, 115.83, 115.83, 115.85, 115.75, 115.84, 116.12, 116.12, 116.12, 116.71000000000001, 115.37, 115.48, 115.62, 115.62, 115.62, 115.65, 115.54, 115.63, 115.76, 115.76, 115.76, 115.98, 115.23, 115.29, 115.79, 115.79, 115.79, 115.8, 115.48, 115.68, 115.71, 115.71, 115.71, 116.02, 114.62, 114.94, 115.4, 115.4, 115.4, 115.48, 114.76, 114.86, 115.06, 115.06, 115.06, 115.12, 114.86, 115.07, 115.08, 115.08, 115.08, 115.2, 114.44, 114.7, 115.26, 115.26, 115.26, 115.26, 115.15, 115.25, 115.66, 115.66, 115.66, 115.78, 115.16, 115.23, 115.94, 115.94, 115.94, 115.98, 115.59, 115.95, 115.98, 115.98, 115.98, 116.26, 115.96, 115.97, 116.21000000000001, 116.21000000000001, 116.21000000000001, 116.26, 116.17, 116.21000000000001, 116.41, 116.41, 116.41, 116.55, 116.39, 116.4, 116.9, 116.9, 116.9, 116.91, 116.65, 116.69, 117.2, 117.2, 117.2, 117.46999999999998, 116.03, 116.37, 116.65, 116.65, 116.65, 116.7, 116.27, 116.43, 116.57000000000001, 116.57000000000001, 116.57000000000001, 116.66], "boxpoints": false, "name": "Increasing", "showlegend": false, "line": {"color": "#3D9970"}}, {"type": "box", "x": ["2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15"], "fillcolor": "#FF4136", "whiskerwidth": 0, "y": [114.78, 115.01, 114.85, 114.85, 114.85, 115.19, 114.63, 114.84, 114.76, 114.76, 114.76, 114.97, 114.89, 115.06, 114.99, 114.99, 114.99, 115.25, 114.57, 114.98, 114.91, 114.91, 114.91, 115.22, 114.87, 115.42, 115.06, 115.06, 115.06, 115.49, 115.05, 115.43, 115.07, 115.07, 115.07, 115.64, 115.17, 115.25, 115.23, 115.23, 115.23, 115.4, 114.8, 115.22, 114.84, 114.84, 114.84, 115.29, 114.79, 115.37, 114.87, 114.87, 114.87, 115.42, 114.38, 114.86, 114.63, 114.63, 114.63, 114.93, 114.31, 114.63, 114.51, 114.51, 114.51, 114.72, 114.91, 115.21, 114.94, 114.94, 114.94, 115.35, 115.98, 116.12, 116.06, 116.06, 116.06, 116.32000000000001, 115.33, 116.06, 115.47, 115.47, 115.47, 116.16, 115.15, 115.76, 115.29, 115.29, 115.29, 115.91, 115.52, 115.78, 115.69, 115.69, 115.69, 115.9, 115.15, 115.72, 115.21, 115.21, 115.21, 115.81, 114.89, 115.22, 115.13, 115.13, 115.13, 115.56, 114.81, 115.12, 115.06, 115.06, 115.06, 115.3, 114.57, 115.05, 114.94, 114.94, 114.94, 115.19, 115.05, 115.4, 115.21, 115.21, 115.21, 115.51, 114.46, 115.2, 115.02, 115.02, 115.02, 115.41, 114.79, 115.01, 114.93, 114.93, 114.93, 115.25, 114.84, 114.92, 114.87, 114.87, 114.87, 115.1, 114.47, 115.09, 114.76, 114.76, 114.76, 115.29, 114.75, 114.77, 114.76, 114.76, 114.76, 115.13, 114.46, 114.75, 114.69, 114.69, 114.69, 114.92, 115.41, 115.66, 115.64, 115.64, 115.64, 116.0, 115.31, 115.65, 115.41, 115.41, 115.41, 115.79, 115.2, 115.4, 115.4, 115.4, 115.4, 115.47, 115.09, 115.4, 115.22, 115.22, 115.22, 115.54, 116.61, 116.9, 116.7, 116.7, 116.7, 117.22, 116.77, 117.19, 116.83, 116.83, 116.83, 117.38, 116.27, 116.82000000000001, 116.38, 116.38, 116.38, 117.01, 116.3, 116.65, 116.44, 116.44, 116.44, 116.82000000000001], "boxpoints": false, "name": "Decreasing", "showlegend": false, "line": {"color": "#FF4136"}}], {"xaxis": {"showgrid": true}}, {"linkText": "Export to plot.ly", "showLink": true})});</script>


# 指標

## 指標の追加


```python
# 終値25日移動平均線追加
x.add_indicator('close_25_sma')
```




    2017-03-20    114.850000
    2017-03-21    114.805000
    2017-03-22    114.886667
    2017-03-23    114.912500
    2017-03-24    114.912000
    2017-03-27    114.940000
    2017-03-28    115.010000
    2017-03-29    115.016250
    2017-03-30    115.062222
    2017-03-31    115.063000
    2017-04-03    115.066364
    2017-04-04    115.082500
    2017-04-05    115.093846
    2017-04-06    115.075714
    2017-04-07    115.093333
    2017-04-10    115.111250
    2017-04-11    115.097059
    2017-04-12    115.071111
    2017-04-13    115.041579
    2017-04-14    115.037000
    2017-04-17    115.039048
    2017-04-18    115.047273
    2017-04-19    115.042609
    2017-04-20    115.075417
    2017-04-21    115.117200
    2017-04-24    115.165600
    2017-04-25    115.194000
    2017-04-26    115.216800
    2017-04-27    115.247600
    2017-04-28    115.262800
                     ...    
    2017-05-08    115.319600
    2017-05-09    115.306800
    2017-05-10    115.313600
    2017-05-11    115.328400
    2017-05-12    115.315600
    2017-05-15    115.297600
    2017-05-16    115.297600
    2017-05-17    115.314800
    2017-05-18    115.337600
    2017-05-19    115.330000
    2017-05-22    115.317200
    2017-05-23    115.296000
    2017-05-24    115.308800
    2017-05-25    115.302000
    2017-05-26    115.282800
    2017-05-29    115.256800
    2017-05-30    115.254000
    2017-05-31    115.238000
    2017-06-01    115.245200
    2017-06-02    115.272800
    2017-06-05    115.289600
    2017-06-06    115.318400
    2017-06-07    115.366000
    2017-06-08    115.425600
    2017-06-09    115.508400
    2017-06-12    115.579200
    2017-06-13    115.636800
    2017-06-14    115.686800
    2017-06-15    115.736000
    2017-06-16    115.798000
    Freq: B, Name: close_25_sma, dtype: float64



`add_indicator`関数の戻り値は`StockDataFrame`クラスで`get`メソッドを使った時と同じ結果が返ってきます。

裏でplotly形式に直され、インスタンス変数self.figに追加されます。


```python
# キャンドルチャートと追加された指標のプロット
x.candle_plot()
```


<div id="bd12c0cf-94eb-4eb7-9fcc-05190e4490e6" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("bd12c0cf-94eb-4eb7-9fcc-05190e4490e6", [{"type": "box", "x": ["2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16"], "fillcolor": "#3D9970", "whiskerwidth": 0, "y": [114.62, 114.77, 115.05, 115.05, 115.05, 115.14, 114.62, 114.91, 115.08, 115.08, 115.08, 115.08, 115.01, 115.07, 115.43, 115.43, 115.43, 115.59, 114.96, 115.06, 115.43, 115.43, 115.43, 115.56, 114.88, 115.08, 115.1, 115.1, 115.1, 115.28, 115.0, 115.1, 115.26, 115.26, 115.26, 115.47, 114.65, 114.85, 115.34, 115.34, 115.34, 115.34, 115.3, 115.35, 115.38, 115.38, 115.38, 115.68, 114.28, 114.51, 114.95, 114.95, 114.95, 115.12, 114.55, 114.94, 115.08, 115.08, 115.08, 115.13, 114.89, 115.08, 115.22, 115.22, 115.22, 115.27, 114.93, 114.95, 115.83, 115.83, 115.83, 115.85, 115.75, 115.84, 116.12, 116.12, 116.12, 116.71000000000001, 115.37, 115.48, 115.62, 115.62, 115.62, 115.65, 115.54, 115.63, 115.76, 115.76, 115.76, 115.98, 115.23, 115.29, 115.79, 115.79, 115.79, 115.8, 115.48, 115.68, 115.71, 115.71, 115.71, 116.02, 114.62, 114.94, 115.4, 115.4, 115.4, 115.48, 114.76, 114.86, 115.06, 115.06, 115.06, 115.12, 114.86, 115.07, 115.08, 115.08, 115.08, 115.2, 114.44, 114.7, 115.26, 115.26, 115.26, 115.26, 115.15, 115.25, 115.66, 115.66, 115.66, 115.78, 115.16, 115.23, 115.94, 115.94, 115.94, 115.98, 115.59, 115.95, 115.98, 115.98, 115.98, 116.26, 115.96, 115.97, 116.21000000000001, 116.21000000000001, 116.21000000000001, 116.26, 116.17, 116.21000000000001, 116.41, 116.41, 116.41, 116.55, 116.39, 116.4, 116.9, 116.9, 116.9, 116.91, 116.65, 116.69, 117.2, 117.2, 117.2, 117.46999999999998, 116.03, 116.37, 116.65, 116.65, 116.65, 116.7, 116.27, 116.43, 116.57000000000001, 116.57000000000001, 116.57000000000001, 116.66], "boxpoints": false, "name": "Increasing", "showlegend": false, "line": {"color": "#3D9970"}}, {"type": "box", "x": ["2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15"], "fillcolor": "#FF4136", "whiskerwidth": 0, "y": [114.78, 115.01, 114.85, 114.85, 114.85, 115.19, 114.63, 114.84, 114.76, 114.76, 114.76, 114.97, 114.89, 115.06, 114.99, 114.99, 114.99, 115.25, 114.57, 114.98, 114.91, 114.91, 114.91, 115.22, 114.87, 115.42, 115.06, 115.06, 115.06, 115.49, 115.05, 115.43, 115.07, 115.07, 115.07, 115.64, 115.17, 115.25, 115.23, 115.23, 115.23, 115.4, 114.8, 115.22, 114.84, 114.84, 114.84, 115.29, 114.79, 115.37, 114.87, 114.87, 114.87, 115.42, 114.38, 114.86, 114.63, 114.63, 114.63, 114.93, 114.31, 114.63, 114.51, 114.51, 114.51, 114.72, 114.91, 115.21, 114.94, 114.94, 114.94, 115.35, 115.98, 116.12, 116.06, 116.06, 116.06, 116.32000000000001, 115.33, 116.06, 115.47, 115.47, 115.47, 116.16, 115.15, 115.76, 115.29, 115.29, 115.29, 115.91, 115.52, 115.78, 115.69, 115.69, 115.69, 115.9, 115.15, 115.72, 115.21, 115.21, 115.21, 115.81, 114.89, 115.22, 115.13, 115.13, 115.13, 115.56, 114.81, 115.12, 115.06, 115.06, 115.06, 115.3, 114.57, 115.05, 114.94, 114.94, 114.94, 115.19, 115.05, 115.4, 115.21, 115.21, 115.21, 115.51, 114.46, 115.2, 115.02, 115.02, 115.02, 115.41, 114.79, 115.01, 114.93, 114.93, 114.93, 115.25, 114.84, 114.92, 114.87, 114.87, 114.87, 115.1, 114.47, 115.09, 114.76, 114.76, 114.76, 115.29, 114.75, 114.77, 114.76, 114.76, 114.76, 115.13, 114.46, 114.75, 114.69, 114.69, 114.69, 114.92, 115.41, 115.66, 115.64, 115.64, 115.64, 116.0, 115.31, 115.65, 115.41, 115.41, 115.41, 115.79, 115.2, 115.4, 115.4, 115.4, 115.4, 115.47, 115.09, 115.4, 115.22, 115.22, 115.22, 115.54, 116.61, 116.9, 116.7, 116.7, 116.7, 117.22, 116.77, 117.19, 116.83, 116.83, 116.83, 117.38, 116.27, 116.82000000000001, 116.38, 116.38, 116.38, 117.01, 116.3, 116.65, 116.44, 116.44, 116.44, 116.82000000000001], "boxpoints": false, "name": "Decreasing", "showlegend": false, "line": {"color": "#FF4136"}}, {"type": "scatter", "x": ["2017-03-20", "2017-03-21", "2017-03-22", "2017-03-23", "2017-03-24", "2017-03-27", "2017-03-28", "2017-03-29", "2017-03-30", "2017-03-31", "2017-04-03", "2017-04-04", "2017-04-05", "2017-04-06", "2017-04-07", "2017-04-10", "2017-04-11", "2017-04-12", "2017-04-13", "2017-04-14", "2017-04-17", "2017-04-18", "2017-04-19", "2017-04-20", "2017-04-21", "2017-04-24", "2017-04-25", "2017-04-26", "2017-04-27", "2017-04-28", "2017-05-01", "2017-05-02", "2017-05-03", "2017-05-04", "2017-05-05", "2017-05-08", "2017-05-09", "2017-05-10", "2017-05-11", "2017-05-12", "2017-05-15", "2017-05-16", "2017-05-17", "2017-05-18", "2017-05-19", "2017-05-22", "2017-05-23", "2017-05-24", "2017-05-25", "2017-05-26", "2017-05-29", "2017-05-30", "2017-05-31", "2017-06-01", "2017-06-02", "2017-06-05", "2017-06-06", "2017-06-07", "2017-06-08", "2017-06-09", "2017-06-12", "2017-06-13", "2017-06-14", "2017-06-15", "2017-06-16"], "name": "CLOSE 25 SMA", "y": [114.85, 114.805, 114.88666666666667, 114.91250000000001, 114.912, 114.94000000000001, 115.01000000000002, 115.01625000000001, 115.06222222222225, 115.06300000000002, 115.06636363636363, 115.0825, 115.09384615384616, 115.07571428571428, 115.09333333333332, 115.11124999999998, 115.0970588235294, 115.0711111111111, 115.04157894736842, 115.03699999999999, 115.03904761904761, 115.0472727272727, 115.04260869565215, 115.07541666666664, 115.11719999999997, 115.16559999999998, 115.19399999999996, 115.21679999999995, 115.24759999999996, 115.26279999999997, 115.29119999999998, 115.30159999999998, 115.32759999999999, 115.3188, 115.32119999999999, 115.3196, 115.30679999999998, 115.3136, 115.32839999999999, 115.31559999999998, 115.29759999999996, 115.29759999999996, 115.31479999999996, 115.33759999999995, 115.32999999999997, 115.31719999999997, 115.29599999999999, 115.30879999999999, 115.30199999999999, 115.2828, 115.25679999999998, 115.25399999999999, 115.238, 115.24519999999998, 115.27279999999999, 115.2896, 115.31839999999998, 115.36599999999999, 115.42559999999997, 115.50839999999997, 115.57919999999996, 115.63679999999997, 115.68679999999996, 115.73599999999996, 115.79799999999997]}], {"xaxis": {"showgrid": true}}, {"linkText": "Export to plot.ly", "showLink": true})});</script>


終値25日移動平均線が追加されました。


```python
# 終値25日指数移動平均線の追加とプロット
x.add_indicator('close_25_ema')
x.candle_plot()
```


<div id="131ab3c9-7602-499a-860e-f5877f525aa2" style="height: 525px; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">require(["plotly"], function(Plotly) { window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("131ab3c9-7602-499a-860e-f5877f525aa2", [{"type": "box", "x": ["2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-22", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-27", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-28", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-03-30", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-03", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-04", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-07", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-10", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-14", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-17", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-18", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-20", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-21", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-26", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-04-27", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-01", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-03", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-10", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-17", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-18", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-24", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-05-25", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-01", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-02", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-05", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-06", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-07", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-09", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-14", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16", "2017-06-16"], "fillcolor": "#3D9970", "whiskerwidth": 0, "y": [114.62, 114.77, 115.05, 115.05, 115.05, 115.14, 114.62, 114.91, 115.08, 115.08, 115.08, 115.08, 115.01, 115.07, 115.43, 115.43, 115.43, 115.59, 114.96, 115.06, 115.43, 115.43, 115.43, 115.56, 114.88, 115.08, 115.1, 115.1, 115.1, 115.28, 115.0, 115.1, 115.26, 115.26, 115.26, 115.47, 114.65, 114.85, 115.34, 115.34, 115.34, 115.34, 115.3, 115.35, 115.38, 115.38, 115.38, 115.68, 114.28, 114.51, 114.95, 114.95, 114.95, 115.12, 114.55, 114.94, 115.08, 115.08, 115.08, 115.13, 114.89, 115.08, 115.22, 115.22, 115.22, 115.27, 114.93, 114.95, 115.83, 115.83, 115.83, 115.85, 115.75, 115.84, 116.12, 116.12, 116.12, 116.71000000000001, 115.37, 115.48, 115.62, 115.62, 115.62, 115.65, 115.54, 115.63, 115.76, 115.76, 115.76, 115.98, 115.23, 115.29, 115.79, 115.79, 115.79, 115.8, 115.48, 115.68, 115.71, 115.71, 115.71, 116.02, 114.62, 114.94, 115.4, 115.4, 115.4, 115.48, 114.76, 114.86, 115.06, 115.06, 115.06, 115.12, 114.86, 115.07, 115.08, 115.08, 115.08, 115.2, 114.44, 114.7, 115.26, 115.26, 115.26, 115.26, 115.15, 115.25, 115.66, 115.66, 115.66, 115.78, 115.16, 115.23, 115.94, 115.94, 115.94, 115.98, 115.59, 115.95, 115.98, 115.98, 115.98, 116.26, 115.96, 115.97, 116.21000000000001, 116.21000000000001, 116.21000000000001, 116.26, 116.17, 116.21000000000001, 116.41, 116.41, 116.41, 116.55, 116.39, 116.4, 116.9, 116.9, 116.9, 116.91, 116.65, 116.69, 117.2, 117.2, 117.2, 117.46999999999998, 116.03, 116.37, 116.65, 116.65, 116.65, 116.7, 116.27, 116.43, 116.57000000000001, 116.57000000000001, 116.57000000000001, 116.66], "boxpoints": false, "name": "Increasing", "showlegend": false, "line": {"color": "#3D9970"}}, {"type": "box", "x": ["2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-20", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-21", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-23", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-24", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-29", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-03-31", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-05", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-06", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-11", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-12", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-13", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-19", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-24", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-25", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-04-28", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-02", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-04", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-05", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-08", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-09", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-11", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-12", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-15", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-16", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-19", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-22", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-23", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-26", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-29", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-30", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-05-31", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-08", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-12", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-13", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15", "2017-06-15"], "fillcolor": "#FF4136", "whiskerwidth": 0, "y": [114.78, 115.01, 114.85, 114.85, 114.85, 115.19, 114.63, 114.84, 114.76, 114.76, 114.76, 114.97, 114.89, 115.06, 114.99, 114.99, 114.99, 115.25, 114.57, 114.98, 114.91, 114.91, 114.91, 115.22, 114.87, 115.42, 115.06, 115.06, 115.06, 115.49, 115.05, 115.43, 115.07, 115.07, 115.07, 115.64, 115.17, 115.25, 115.23, 115.23, 115.23, 115.4, 114.8, 115.22, 114.84, 114.84, 114.84, 115.29, 114.79, 115.37, 114.87, 114.87, 114.87, 115.42, 114.38, 114.86, 114.63, 114.63, 114.63, 114.93, 114.31, 114.63, 114.51, 114.51, 114.51, 114.72, 114.91, 115.21, 114.94, 114.94, 114.94, 115.35, 115.98, 116.12, 116.06, 116.06, 116.06, 116.32000000000001, 115.33, 116.06, 115.47, 115.47, 115.47, 116.16, 115.15, 115.76, 115.29, 115.29, 115.29, 115.91, 115.52, 115.78, 115.69, 115.69, 115.69, 115.9, 115.15, 115.72, 115.21, 115.21, 115.21, 115.81, 114.89, 115.22, 115.13, 115.13, 115.13, 115.56, 114.81, 115.12, 115.06, 115.06, 115.06, 115.3, 114.57, 115.05, 114.94, 114.94, 114.94, 115.19, 115.05, 115.4, 115.21, 115.21, 115.21, 115.51, 114.46, 115.2, 115.02, 115.02, 115.02, 115.41, 114.79, 115.01, 114.93, 114.93, 114.93, 115.25, 114.84, 114.92, 114.87, 114.87, 114.87, 115.1, 114.47, 115.09, 114.76, 114.76, 114.76, 115.29, 114.75, 114.77, 114.76, 114.76, 114.76, 115.13, 114.46, 114.75, 114.69, 114.69, 114.69, 114.92, 115.41, 115.66, 115.64, 115.64, 115.64, 116.0, 115.31, 115.65, 115.41, 115.41, 115.41, 115.79, 115.2, 115.4, 115.4, 115.4, 115.4, 115.47, 115.09, 115.4, 115.22, 115.22, 115.22, 115.54, 116.61, 116.9, 116.7, 116.7, 116.7, 117.22, 116.77, 117.19, 116.83, 116.83, 116.83, 117.38, 116.27, 116.82000000000001, 116.38, 116.38, 116.38, 117.01, 116.3, 116.65, 116.44, 116.44, 116.44, 116.82000000000001], "boxpoints": false, "name": "Decreasing", "showlegend": false, "line": {"color": "#FF4136"}}, {"type": "scatter", "x": ["2017-03-20", "2017-03-21", "2017-03-22", "2017-03-23", "2017-03-24", "2017-03-27", "2017-03-28", "2017-03-29", "2017-03-30", "2017-03-31", "2017-04-03", "2017-04-04", "2017-04-05", "2017-04-06", "2017-04-07", "2017-04-10", "2017-04-11", "2017-04-12", "2017-04-13", "2017-04-14", "2017-04-17", "2017-04-18", "2017-04-19", "2017-04-20", "2017-04-21", "2017-04-24", "2017-04-25", "2017-04-26", "2017-04-27", "2017-04-28", "2017-05-01", "2017-05-02", "2017-05-03", "2017-05-04", "2017-05-05", "2017-05-08", "2017-05-09", "2017-05-10", "2017-05-11", "2017-05-12", "2017-05-15", "2017-05-16", "2017-05-17", "2017-05-18", "2017-05-19", "2017-05-22", "2017-05-23", "2017-05-24", "2017-05-25", "2017-05-26", "2017-05-29", "2017-05-30", "2017-05-31", "2017-06-01", "2017-06-02", "2017-06-05", "2017-06-06", "2017-06-07", "2017-06-08", "2017-06-09", "2017-06-12", "2017-06-13", "2017-06-14", "2017-06-15", "2017-06-16"], "name": "CLOSE 25 SMA", "y": [114.85, 114.805, 114.88666666666667, 114.91250000000001, 114.912, 114.94000000000001, 115.01000000000002, 115.01625000000001, 115.06222222222225, 115.06300000000002, 115.06636363636363, 115.0825, 115.09384615384616, 115.07571428571428, 115.09333333333332, 115.11124999999998, 115.0970588235294, 115.0711111111111, 115.04157894736842, 115.03699999999999, 115.03904761904761, 115.0472727272727, 115.04260869565215, 115.07541666666664, 115.11719999999997, 115.16559999999998, 115.19399999999996, 115.21679999999995, 115.24759999999996, 115.26279999999997, 115.29119999999998, 115.30159999999998, 115.32759999999999, 115.3188, 115.32119999999999, 115.3196, 115.30679999999998, 115.3136, 115.32839999999999, 115.31559999999998, 115.29759999999996, 115.29759999999996, 115.31479999999996, 115.33759999999995, 115.32999999999997, 115.31719999999997, 115.29599999999999, 115.30879999999999, 115.30199999999999, 115.2828, 115.25679999999998, 115.25399999999999, 115.238, 115.24519999999998, 115.27279999999999, 115.2896, 115.31839999999998, 115.36599999999999, 115.42559999999997, 115.50839999999997, 115.57919999999996, 115.63679999999997, 115.68679999999996, 115.73599999999996, 115.79799999999997]}, {"type": "scatter", "x": ["2017-03-20", "2017-03-21", "2017-03-22", "2017-03-23", "2017-03-24", "2017-03-27", "2017-03-28", "2017-03-29", "2017-03-30", "2017-03-31", "2017-04-03", "2017-04-04", "2017-04-05", "2017-04-06", "2017-04-07", "2017-04-10", "2017-04-11", "2017-04-12", "2017-04-13", "2017-04-14", "2017-04-17", "2017-04-18", "2017-04-19", "2017-04-20", "2017-04-21", "2017-04-24", "2017-04-25", "2017-04-26", "2017-04-27", "2017-04-28", "2017-05-01", "2017-05-02", "2017-05-03", "2017-05-04", "2017-05-05", "2017-05-08", "2017-05-09", "2017-05-10", "2017-05-11", "2017-05-12", "2017-05-15", "2017-05-16", "2017-05-17", "2017-05-18", "2017-05-19", "2017-05-22", "2017-05-23", "2017-05-24", "2017-05-25", "2017-05-26", "2017-05-29", "2017-05-30", "2017-05-31", "2017-06-01", "2017-06-02", "2017-06-05", "2017-06-06", "2017-06-07", "2017-06-08", "2017-06-09", "2017-06-12", "2017-06-13", "2017-06-14", "2017-06-15", "2017-06-16"], "name": "CLOSE 25 EMA", "y": [114.85, 114.80319999999999, 114.89213219616204, 114.91961022364217, 114.91736887662194, 114.95017145030083, 115.03621617300986, 115.04008500941771, 115.09850228222274, 115.0945221933906, 115.0952419767404, 115.11577271784282, 115.1293588476819, 115.09633040161668, 115.12314563876606, 115.15050554460059, 115.12148522234543, 115.07195185550857, 115.01663647045413, 115.01021527872585, 115.01681161811312, 115.0356856190529, 115.02693714000968, 115.09931082177685, 115.19009912280187, 115.26655571251167, 115.28424267328367, 115.31314318862142, 115.35125781420271, 115.3460762121947, 115.38334071688188, 115.40890330277801, 115.4338417177633, 115.4154107503567, 115.39203683076984, 115.36497898372518, 115.3305046928918, 115.33611859045784, 115.32596976273375, 115.30143525345336, 115.27174819283783, 115.23973447371289, 115.2254516096936, 115.21392240711671, 115.1780263686463, 115.14504011563137, 115.10920431141359, 115.12105824165391, 115.16335271435642, 115.20070047920255, 115.21707672066563, 115.23137033569247, 115.23048293813028, 115.2857951246968, 115.33985768691824, 115.40755714409663, 115.48548139898462, 115.59534896480942, 115.68108454583175, 115.79889123422417, 115.87881287927806, 115.9176372875004, 115.97433896685955, 116.01037380354401, 116.05366010219106]}], {"xaxis": {"showgrid": true}}, {"linkText": "Export to plot.ly", "showLink": true})});</script>


先ほど追加された終値25日移動平均線に加え、終値25日指数移動平均線が追加されました。

## 指標の削除


```python
y = StockPlot(sdf)
# 10,11,12,13足移動平均線
for i in range(10, 14):
    y.add_indicator('close_{}_sma'.format(i))
y.candle_plot()
```


    ---------------------------------------------------------------------------

    NameError                                 Traceback (most recent call last)

    <ipython-input-13-2e1cbbb460ea> in <module>()
    ----> 1 y = StockPlot(sdf)
          2 # 10,11,12,13足移動平均線
          3 for i in range(10, 14):
          4     y.add_indicator('close_{}_sma'.format(i))
          5 y.candle_plot()
    

    NameError: name 'StockPlot' is not defined



```python
# 10, 12足移動平均線の削除
for i in (10, 12):
    y.remove_indicator('close_{}_sma'.format(i))
y.candle_plot()
```

# ファイルへのエクスポート

StockPlotクラスはPlotlyのhtmlエクスポートする`plotly.offline.iplot`(Jupyter Notebook形式)で図を吐き出します。
つまり、ファイルへのエクスポートがされません。

ファイルとして吐き出したいときは以下のメソッドを使います。

* html形式: `plotly.offline.plot()`
* png, svg, jpeg, webp形式: `plotly.offline.image`


```python
pyo.plot(y.fig, filename='candle_y.html', validate=False)
```


```python
pyo.plot(y.fig, image='png', image_filename='candle_y')
```


```python

```
